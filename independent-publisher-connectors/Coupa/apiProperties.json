{
   "properties":{
      "connectionParameters":{
         "token":{
            "type":"oauthSetting",
            "oAuthSettings":{
               "identityProvider":"oauth2generic",
               "scopes":[
                  
               ],
               "redirectMode":"Global",
               "redirectUrl":"https://global.consent.azure-apim.net/redirect",
               "properties":{
                  "IsFirstParty":"False",
                  "IsOnbehalfofLoginSupported":false
               },
               "customParameters":{
                  "authorizationUrlTemplate":{
                     "value":"https://{customHost}.coupahost.com/oauth2/authorizations"
                  },
                  "authorizationUrlQueryStringTemplate":{
                     "value":"/new?client_id={customClientId}&response_type=code&redirect_uri=https://global.consent.azure-apim.net/redirect&scope={scope}&state={State}"
                  },
                  "tokenUrlTemplate":{
                     "value":"https://{customHost}.coupahost.com/oauth2/token"
                  },
                  "tokenBodyTemplate":{
                     "value":"code={code}&grant_type=authorization_code&redirect_uri={redirectUrl}&client_id={customClientId}&client_secret={customClientSecret}&scope=core.inventory.receiving.read core.purchase_order.read core.comment.write"
                  },
                  "refreshUrlTemplate":{
                     "value":"https://{customHost}.coupahost.com/oauth2/token"
                  },
                  "refreshBodyTemplate":{
                     "value":"code={code}&grant_type=authorization_code&redirect_uri={redirectUrl}&client_id={customClientId}&client_secret={customClientSecret}&scope=core.inventory.receiving.read core.purchase_order.read core.comment.write"
                  }
               }
            },
            "uiDefinition":{
               "displayName":"Login your Credentials",
               "description":"Sign in with your Azure Active Directory credentials",
               "tooltip":"Provide  Azure Active Directory credentials",
               "constraints":{
                  "required":"true",
                  "hidden":"false"
               }
            }
         },
         "token:customHost":{
            "type":"string",
            "uiDefinition":{
               "constraints":{
                  "required":"true",
                  "tabIndex":3
               },
               "displayName":"Host",
               "description":"Enter host domain, www.example.com",
               "tooltip":"Save your notes about this connection."
            }
         },
         "token:customBasePath":{
            "type":"string",
            "uiDefinition":{
               "constraints":{
                  "required":"true",
                  "tabIndex":3
               },
               "displayName":"Integration path",
               "description":"Enter integration path, /MSFlow",
               "tooltip":"Save your notes about this connection."
            }
         },
         "token:customClientId":{
            "type":"string",
            "uiDefinition":{
               "constraints":{
                  "required":"true",
                  "tabIndex":3
               },
               "description":"Enter OAuth Client Id",
               "displayName":"Client Id",
               "tooltip":"Save your notes about this connection."
            }
         },
         "token:customClientSecret":{
            "type":"string",
            "uiDefinition":{
               "constraints":{
                  "required":"true",
                  "tabIndex":3
               },
               "description":"Enter OAuth Client Secret",
               "displayName":"Client Secret",
               "tooltip":"Save your notes about this connection."
            }
         }
      },
      "connectionParameterSets":{
         "uiDefinition":{
            "displayName":"Server Type",
            "description":"Type of server to be used."
         },
         "values":[
            {
               "name":"OAuth2Customer",
               "uiDefinition":{
                  "displayName":"Customer Instance",
                  "description":"Customer Instance",
                  "constraints":{
                     "hidden":"false"
                  }
               },
               "parameters":{
                  "token":{
                     "type":"oauthSetting",
                     "oAuthSettings":{
                        "identityProvider":"oauth2generic",
                        "scopes":[
                           
                        ],
                        "redirectMode":"Global",
                        "redirectUrl":"https://global.consent.azure-apim.net/redirect",
                        "properties":{
                           "IsFirstParty":"False",
                           "IsOnbehalfofLoginSupported":false
                        },
                        "customParameters":{
                           "authorizationUrlTemplate":{
                              "value":"https://{customHost}.coupahost.com/oauth2/authorizations"
                           },
                           "authorizationUrlQueryStringTemplate":{
                              "value":"/new?client_id={customClientId}&response_type=code&redirect_uri=https://global.consent.azure-apim.net/redirect&scope={scope}&state={State}"
                           },
                           "tokenUrlTemplate":{
                              "value":"https://{customHost}.coupahost.com/oauth2/token"
                           },
                           "tokenBodyTemplate":{
                              "value":"code={code}&grant_type=authorization_code&redirect_uri={redirectUrl}&client_id={customClientId}&client_secret={customClientSecret}&scope={scope}"
                           },
                           "refreshUrlTemplate":{
                              "value":"https://{customHost}.coupahost.com/oauth2/token"
                           },
                           "refreshBodyTemplate":{
                              "value":"code={code}&grant_type=authorization_code&redirect_uri={redirectUrl}&client_id={customClientId}&client_secret={customClientSecret}&scope={scope}"
                           }
                        }
                     },
                     "uiDefinition":{
                        "displayName":"Login your Credentials",
                        "description":"Sign in with your credentials",
                        "tooltip":"Provide  credentials",
                        "constraints":{
                           "required":"true",
                           "hidden":"false"
                        }
                     }
                  },
                  "token:customHost":{
                     "type":"string",
                     "uiDefinition":{
                        "constraints":{
                           "required":"true",
                           "tabIndex":3
                        },
                        "displayName":"instance",
                        "description":"Enter instance excluding coupahost.com",
                        "tooltip":"Only enter the name of your instance eg instance-dev"
                     }
                  },
                  "token:scope":{
                     "type":"string",
                     "uiDefinition":{
                        "constraints":{
                           "required":"true",
                           "tabIndex":3
                        },
                        "displayName":"Scopes",
                        "description":"Enter scopes with no commas",
                        "tooltip":"Save your notes about this connection."
                     }
                  },
                  "token:customClientId":{
                     "type":"securestring",
                     "uiDefinition":{
                        "constraints":{
                           "required":"true",
                           "clearText":true,
                           "tabIndex":3
                        },
                        "description":"Enter OAuth Client Id",
                        "displayName":"Client Id",
                        "tooltip":"Save your notes about this connection."
                     }
                  },
                  "token:customClientSecret":{
                     "type":"securestring",
                     "uiDefinition":{
                        "constraints":{
                           "required":"true",
                           "clearText":false,
                           "tabIndex":3
                        },
                        "description":"Enter OAuth Client Secret",
                        "displayName":"Client Secret",
                        "tooltip":"Save your notes about this connection."
                     }
                  }
               }
            },
            {
               "name":"OAuth2Demo",
               "uiDefinition":{
                  "displayName":"Partner or Demo Instance",
                  "description":"Partner or Demo Instance",
                  "constraints":{
                     "hidden":"false"
                  }
               },
               "parameters":{
                  "token":{
                     "type":"oauthSetting",
                     "oAuthSettings":{
                        "identityProvider":"oauth2generic",
                        "scopes":[
                           
                        ],
                        "redirectMode":"Global",
                        "redirectUrl":"https://global.consent.azure-apim.net/redirect",
                        "properties":{
                           "IsFirstParty":"False",
                           "IsOnbehalfofLoginSupported":false
                        },
                        "customParameters":{
                           "authorizationUrlTemplate":{
                              "value":"https://{customHost}.coupacloud.com/oauth2/authorizations"
                           },
                           "authorizationUrlQueryStringTemplate":{
                              "value":"/new?client_id={customClientId}&response_type=code&redirect_uri=https://global.consent.azure-apim.net/redirect&scope={scope}&state={State}"
                           },
                           "tokenUrlTemplate":{
                              "value":"https://{customHost}.coupacloud.com/oauth2/token"
                           },
                           "tokenBodyTemplate":{
                              "value":"code={code}&grant_type=authorization_code&redirect_uri={redirectUrl}&client_id={customClientId}&client_secret={customClientSecret}&scope={scope}"
                           },
                           "refreshUrlTemplate":{
                              "value":"https://{customHost}.coupacloud.com/oauth2/token"
                           },
                           "refreshBodyTemplate":{
                              "value":"code={code}&grant_type=authorization_code&redirect_uri={redirectUrl}&client_id={customClientId}&client_secret={customClientSecret}&scope={scope}"
                           }
                        }
                     },
                     "uiDefinition":{
                        "displayName":"Login your Credentials",
                        "description":"Sign in with your credentials",
                        "tooltip":"Provide  credentials",
                        "constraints":{
                           "required":"true",
                           "hidden":"false"
                        }
                     }
                  },
                  "token:customHost":{
                     "type":"string",
                     "uiDefinition":{
                        "constraints":{
                           "required":"true",
                           "tabIndex":3
                        },
                        "displayName":"instance",
                        "description":"Enter instance excluding coupacloud.com",
                        "tooltip":"Only enter the name of your instance eg instance-dev"
                     }
                  },
                  "token:scope":{
                     "type":"string",
                     "uiDefinition":{
                        "constraints":{
                           "required":"true",
                           "tabIndex":3
                        },
                        "displayName":"Scopes",
                        "description":"Enter scopes with no commas",
                        "tooltip":"Save your notes about this connection."
                     }
                  },
                  "token:customClientId":{
                     "type":"securestring",
                     "uiDefinition":{
                        "constraints":{
                           "required":"true",
                           "clearText":true,
                           "tabIndex":3
                        },
                        "description":"Enter OAuth Client Id",
                        "displayName":"Client Id",
                        "tooltip":"Save your notes about this connection."
                     }
                  },
                  "token:customClientSecret":{
                     "type":"securestring",
                     "uiDefinition":{
                        "constraints":{
                           "required":"true",
                           "clearText":false,
                           "tabIndex":3
                        },
                        "description":"Enter OAuth Client Secret",
                        "displayName":"Client Secret",
                        "tooltip":"Save your notes about this connection."
                     }
                  }
               }
            }
         ]
      },
      "iconBrandColor":"#268ecd",
      "capabilities":[
         
      ],
      "policyTemplateInstances":[
         {
            "templateId":"dynamichosturl",
            "title":"Set host for connection",
            "parameters":{
               "x-ms-apimTemplateParameter.urlTemplate":"https://@connectionParameters('token:customHost').coupahost.com"
            }
         },
         {
            "templateId":"setheader",
            "title":"Accept",
            "parameters":{
               "x-ms-apimTemplateParameter.name":"Accept",
               "x-ms-apimTemplateParameter.value":"application/json",
               "x-ms-apimTemplateParameter.existsAction":"override",
               "x-ms-apimTemplate-policySection":"Request"
            }
         }
      ],
      "publisher":"NovaGL",
      "stackOwner":"NovaGL"
   }
}
